(function(){var e=this,t={};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=t}exports.dw=t}else{window.dw=t}t.dataset=function(e,n){var r={};_.each(e,function(e){var t=e.name(),n=t,i=1;while(r.hasOwnProperty(n)){n=t+"."+i++}if(n!=t)e.name(n);r[n]=e});n=_.extend(n,{});var i={columns:function(){return e},column:function(t){if(_.isString(t)){if(r[t]!==undefined)return r[t];throw'No column found with that name: "'+t+'"'}if(e[t]!==undefined)return e[t];throw"No series found with that index: "+t},numColumns:function(){return e.length},numRows:function(){return e[0].length},eachColumn:function(t){_.each(e,t)},series:function(e){if(e!==undefined){return i.column(e)}return i.columns()},eachSeries:function(t){_.each(e,t)},eachRow:function(e){var t;for(t=0;t<i.numRows();t++){e(t)}},rowNames:function(){return e[0].raw()},rowName:function(t){if(t<0)t+=i.numRows();return e[0].raw()[t]},rowNameLabel:function(){return e[0].name()},filterRows:function(t){_.each(e,function(e){if(t)e.filterRows(t);else e.filterRows()})},filterSeries:function(t){e=e.filter(function(e){return!t[e.name()]})},isTimeSeries:function(){return this.__rowDates!==undefined},rowDate:function(e){if(e<0)e+=this.__rowDates.length;return this.__rowDates[e]},rowDates:function(){return this.__rowDates.slice(0)},minMax:function(){return t.utils.minMax(i.columns())}};return i};t.column=function(e,n,r){function a(e){if(_.every(n,_.isNumber))return t.column.types.number();if(_.every(n,_.isDate))return t.column.types.date();var r=[t.column.types.date(e),t.column.types.number(e),t.column.types.text()],i,a=n.length,u=.1;_.each(n,function(e){_.each(r,function(t){t.parse(e)})});_.every(r,function(e){if(e.errors()/a<u)i=e;return!i});return i}var u=_.map(_.shuffle(_.range(n.length)).slice(0,200),function(e){return n[e]});r=r?t.column.types[r](u):a(u);var o,s,f=n.slice(0);var c={name:function(){if(arguments.length){e=arguments[0];return c}return e},length:n.length,val:function(e,t){if(!arguments.length)return undefined;var i=t?f:n;if(e<0)e+=i.length;return r.parse(i[e])},values:function(e){return _.map(e?f:n,r.parse)},each:function(e){for(i=0;i<n.length;i++){e(c.val(i),i)}},raw:function(e){if(!arguments.length)return n;return n[e]},type:function(e){return e?r:r.name()},range:function(){if(!r.toNum)return false;if(!o){o=[Number.MAX_VALUE,-Number.MAX_VALUE];c.each(function(e){e=r.toNum(e);if(e<o[0])o[0]=e;if(e>o[1])o[1]=e});o[0]=r.fromNum(o[0]);o[1]=r.fromNum(o[1])}return o},total:function(){if(!r.toNum)return false;if(!s){s=0;c.each(function(e){s+=r.toNum(e)});s=r.fromNum(s)}return s},filterRows:function(e){n=[];if(arguments.length){_.each(e,function(e){n.push(f[e])})}else{n=f.slice(0)}c.length=n.length;o=s=false;return c},toString:function(){return e+" ("+r.name()+")"}};return c};t.column.types={};t.column.types.text=function(){return{parse:function(e){return e},errors:function(){return 0},name:function(){return"text"}}};t.column.types.number=function(e){var t,n=0,r={"-.":/^ *-?[0-9]*(\.[0-9]+)? *$/,"-,":/^ *-?[0-9]*(,[0-9]+)? *$/,",.":/^ *-?[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)? *$/,".,":/^ *-?[0-9]{1,3}(\.[0-9]{3})*(,[0-9]+)? *$/," .":/^ *-?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)? *$/," ,":/^ *-?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)? *$/," .":/^ *-?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)? *$/," ,":/^ *-?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)? *$/},i={na:1,"n/a":1,"-":1,":":1};var a={},u=["-.",0];e=e||[];_.each(e,function(e){_.each(r,function(t,n){if(a[n]===undefined)a[n]=0;if(t.test(e)){a[n]+=1;if(a[n]>u[1]){u[0]=n;u[1]=a[n]}}})});t=u[0];var o={parse:function(e){if(_.isNumber(e)||_.isUndefined(e)||_.isNull(e))return e;var r=e;if(t[0]!="-"){r=r.replace(t[0],"")}if(t[1]!="."){r=r.replace(t[1],".")}if(isNaN(r)){if(!i[r]&&r!=="")n++;return e}return Number(r)},toNum:function(e){return e},fromNum:function(e){return e},errors:function(){return n},name:function(){return"number"}};return o};t.column.types.date=function(e){var t,n=0,r={},i=["",0],a={YYYY:{regex:/^ *([12][0-9]{3}) *$/,precision:"year"},"YYYY-H":{regex:/^ *([12][0-9]{3})[ \-\/]?H([12]) *$/,precision:"month"},"H-YYYY":{regex:/^ *H([12])[ \-\/]([12][0-9]{3}) *$/,precision:"month"},"YYYY-Q":{regex:/^ *([12][0-9]{3})[ \-\/]?Q([1234]) *$/,precision:"quarter"},"Q-YYYY":{regex:/^ *Q([1234])[ \-\/]([12][0-9]{3}) *$/,precision:"quarter"},"YYYY-M":{regex:/^ *([12][0-9]{3}) ?[ -\/\.M](0?[1-9]|1[0-2]) *$/,precision:"month"},"M-YYYY":{regex:/^ *(0?[1-9]|1[0-2]) ?[ -\/\.]([12][0-9]{3}) *$/,precision:"month"},"MM/DD/YYYY":{regex:/^ *(0?[1-9]|1[0-2])([-\/] ?)(0?[1-9]|[1-2][0-9]|3[01])\2([12][0-9]{3})(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,precision:"day"},"DD.MM.YYYY":{regex:/^ *(0?[1-9]|[1-2][0-9]|3[01])([-\.\/ ?])(0?[1-9]|1[0-2])\2([12][0-9]{3})(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,precision:"day"},"YYYY-MM-DD":{regex:/^ *([12][0-9]{3})([-\/\. ?])(0?[1-9]|1[0-2])\2(0?[1-9]|[1-2][0-9]|3[01])(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,precision:"day"}};e=e||[];_.each(e,function(e){_.each(a,function(t,n){if(r[n]===undefined)r[n]=0;if(t.regex.test(e)){r[n]+=1;if(r[n]>i[1]){i[0]=n;i[1]=r[n]}}})});t=i[0];var u={parse:function(e){if(_.isDate(e)||_.isUndefined(e))return e;if(!t||!_.isString(e)){n++;return e}var r=a[t].regex,i=e.match(r);if(!i){n++;return e}switch(t){case"YYYY":return new Date(i[1],0,1);case"YYYY-H":return new Date(i[1],(i[2]-1)*6,1);case"H-YYYY":return new Date(i[2],(i[1]-1)*6,1);case"YYYY-Q":return new Date(i[1],(i[2]-1)*3,1);case"Q-YYYY":return new Date(i[2],(i[1]-1)*3,1);case"YYYY-M":return new Date(i[1],i[2]-1,1);case"M-YYYY":return new Date(i[2],i[1]-1,1);case"YYYY-MM-DD":return new Date(i[1],i[3]-1,i[4],i[5]||0,i[6]||0,i[7]||0);case"DD.MM.YYYY":return new Date(i[4],i[3]-1,i[1],i[5]||0,i[6]||0,i[7]||0);case"MM/DD/YYYY":return new Date(i[4],i[1]-1,i[3],i[5]||0,i[6]||0,i[7]||0)}n++;return e},toNum:function(e){return e.getTime()},fromNum:function(e){return new Date(e)},errors:function(){return n},name:function(){return"date"},format:function(){return t},precision:function(){return a[t].precision}};return u};t.datasource={};t.datasource.delimited=function(e){function t(){if(e.url){return $.ajax({url:e.url,method:"GET",dataType:"text"}).then(function(t){return new n(e).parse(t)})}else if(e.csv){var t=$.Deferred(),r=t.then(function(t){return new n(e).parse(t)});t.resolve(e.csv);return r}throw"you need to provide either an URL or CSV data."}var r={dataset:t};return r};var n=function(e){e=_.extend({delimiter:"auto",quoteChar:'"',skipRows:0,emptyValue:null,transpose:false,firstRowIsHeader:true},e);this.__delimiterPatterns=r(e.delimiter,e.quoteChar);this.opts=e};function r(e,t){return new RegExp("(\\"+e+"|\\r?\\n|\\r|^)"+"(?:"+t+"([^"+t+"]*(?:"+t+'"[^'+t+"]*)*)"+t+"|"+"([^"+t+"\\"+e+"\\r\\n]*))","gi")}_.extend(n.prototype,{parse:function(e){var n=this,i=this.opts;n.__rawData=e;if(i.delimiter=="auto"){i.delimiter=n.guessDelimiter(e,i.skipRows);n.__delimiterPatterns=r(i.delimiter,i.quoteChar)}var a=[],u=i.delimiter!="|"?"|":"#",o;e=u+e.replace(/\s+$/g,"")+u;function s(e,t,n){n=n||",";var r=[[]];var i=null,a;while(i=e.exec(t)){var o=i[1];if(o.length&&o!=n){r.push([])}if(i[2]){a=i[2].replace(new RegExp('""',"g"),'"')}else{a=i[3]}r[r.length-1].push(a)}if(r[0][0].substr(0,1)==u){r[0][0]=r[0][0].substr(1)}var s=r.length-1,f=r[s].length-1,c=r[s][f].length-1;if(r[s][f].substr(c)==u){r[s][f]=r[s][f].substr(0,c)}return r}function f(e){var t=e,n=t.length?t.length:0,r=t[0]instanceof Array?t[0].length:0;if(r===0||n===0){return[]}var i,a,u=[];for(i=0;i<r;i++){u[i]=[];for(a=0;a<n;a++){u[i][a]=t[a][i]}}return u}function c(e){var n=[],r={},a=e.length,u=e[0].length,o=i.skipRows;var s=[];if(i.firstRowIsHeader){s=e[o];o++}for(var f=0;f<u;f++){var c=_.isString(s[f])?s[f].replace(/^\s+|\s+$/g,""):"",l=c!==""?"":1;c=c!==""?c:"X.";while(r[c+l]!==undefined){l=l===""?1:l+1}n.push({name:c+l,data:[]});r[c+l]=true}_.each(_.range(o,a),function(t){_.each(n,function(n,r){n.data.push(e[t][r]!==""?e[t][r]:i.emptyValue)})});n=_.map(n,function(e){return t.column(e.name,e.data)});return t.dataset(n)}o=s(this.__delimiterPatterns,e,i.delimiter);if(i.transpose){o=f(o)}return c(o)},guessDelimiter:function(e){var t=0,n=-1,i=this,a=["	",";","|",","];_.each(a,function(a,u){var o=r(a,i.quoteChar),s=e.match(o).length;if(s>t){t=s;n=u}});return a[n]}});t.utils={minMax:function(e){var t=[Number.MAX_VALUE,-Number.MAX_VALUE];_.each(e,function(e){t[0]=Math.min(t[0],e.range()[0]);t[1]=Math.max(t[1],e.range()[1])});return t},dateFormat:function(e){var t=true,n=false;function r(e){return function(r){t=n&&r.getMonth()!=n.getMonth();n=r;var i=e.length-1,a=e[i];while(!a[1](r))a=e[--i];return a[0](r)}}return r([[d3.time.format("%Y"),function(){return true}],[d3.time.format(e>70?"%b":"%B"),function(e){return e.getMonth()!==0}],[d3.time.format("%d"),function(e){return e.getDate()!=1}],[d3.time.format(e>70?"%b %d":"%B %d"),function(e){return e.getDate()!=1&&t}],[d3.time.format("%I %p"),function(e){return e.getHours()}],[d3.time.format("%I:%M"),function(e){return e.getMinutes()}],[d3.time.format(":%S"),function(e){return e.getSeconds()}],[d3.time.format(".%L"),function(e){return e.getMilliseconds()}]])},longDateFormat:function(e){var t=this;return function(t){if(e.type()=="date"){switch(e.type(true).precision()){case"year":return t.getFullYear();case"quarter":return t.getFullYear()+" Q"+(t.getMonth()/3+1);case"month":return Globalize.format(t,"MMM yy");case"day":return Globalize.format(t,"d")}}else{return t}}},columnNameColumn:function(e){var n=_.map(e,function(e){return e.name()});return t.column("",n)},name:function(e){return _.isFunction(e.name)?e.name():_.isString(e.name)?e.name:e},getMaxChartHeight:function(e){function t(e,t){if($(e).css("margin-"+t)=="auto")return 0;return+$(e).css("margin-"+t).replace("px","")}var n=0,r=0;$("body > *").each(function(e,i){var a=i.tagName.toLowerCase();if(a!="script"&&i.id!="chart"&&!$(i).hasClass("tooltip")&&!$(i).hasClass("container")){n+=$(i).outerHeight(false)}n+=Math.max(t(i,"top"),r);r=t(i,"bottom")});n+=r;var i=$("#chart").css("margin-top").replace("px",""),a=$("#chart").css("margin-bottom").replace("px",""),u=$(window).height()-n-8;if(!$.support.leadingWhitespace)u-=15;u-=$("body").css("padding-top").replace("px","");u-=$("body").css("padding-bottom").replace("px","");return u}};t.utils.filter=function(e,n,r,i){var a=[],u;r=r||"auto";i=i||_.identity;if(r=="auto"){if(e.type()=="date")r="timescale";else if(e.type()=="text")r=e.length<6?"buttons":"select"}var o={ui:f(r),change:function(e){a.push(e)}};function s(t){_.each(a,function(n){if(_.isFunction(n)){n(e.val(t),t)}})}function f(r){var a;if(e.length<2)return function(){return false};if(r=="select")a=function(t){var n=$("<select />");e.each(function(e,t){var r=i(e);if(!r)return;n.append('<option value="'+t+'">'+(_.isString(r)?$.trim(r):r)+"</option>")});n.change(function(e){var t=n.val();s(t)});n.addClass("filter-ui filter-select");return n};if(r=="buttons")a=function(t){var r=$("<div />");r.addClass("filter-ui filter-links");e.each(function(e,t){var a=i(e);if(!a)return;var u=$('<a href="#'+t+'"'+(t==n?' class="active" ':"")+">"+(_.isString(a)?$.trim(a):a)+"</a>").data("row",t);r.append(u)});$("a",r).click(function(e){var t=$(e.target);e.preventDefault();if(t.hasClass("active"))return;$("a",r).removeClass("active");t.addClass("active");s(t.data("row"))});return r};if(r=="timescale")a=function(r){var i=Math.min(r.__w-30,Math.max(300,r.__w*.7)),a=d3.time.scale().domain([e.val(0),e.val(-1)]).range([0,i]),u=$("<div></div>").css({position:"relative",height:45,"margin-left":3}).addClass("filter-ui"),o=i/80,f=a.ticks(o),c=Math.round((e.val(-1).getTime()-e.val(0).getTime())/864e5),l=t.utils.dateFormat(c),m=t.utils.longDateFormat(e),d=a.ticks(i/8),h=function(t){return Math.max(-18,a(e.val(t))-40)};_.each(f,function(e){var t=$("<span>"+l(e)+"</span>"),n=a(e)-40,i=r.labelWidth(l(e));if(40-i*.5+n<0)n=-40+.5*i;t.css({position:"absolute",top:0,width:80,left:n,"text-align":"center",opacity:.55});u.append(t)});_.each(d,function(t){if(t.getTime()<e.val(0).getTime()||t.getTime()>e.val(-1).getTime())return;var n=$('<span class="dot"></span>');n.css({position:"absolute",bottom:19,width:1,height:"1ex","border-left":"1px solid #000","vertical-align":"bottom",left:Math.round(a(t))+.5});if(!_.find(f,function(e){return t.getTime()==e.getTime()})){n.css({height:"0.6ex",opacity:.5})}u.append(n)});var p=$("<div>▲</div>").css({position:"absolute",width:20,bottom:2,left:a(e.val(n))-9,"text-align":"center"});u.append(p);var g=$("<div><span></span></div>").css({position:"absolute",width:80,top:0,left:h(n),"text-align":"center"}).data("last-txt",m(e.val(n))).data("last-left",h(n));$("span",g).css({background:r.theme.colors.background,"font-weight":"bold",padding:"0 1ex"}).html(m(e.val(n)));u.append(g);$("<div />").css({position:"absolute",width:i+1,bottom:15,height:2,"border-bottom":"1px solid #000"}).appendTo(u);var v=$("<div />").css({position:"absolute",left:0,width:i,height:40});u.append(v);function Y(t){var n=a.invert(t),r=Number.MAX_VALUE,i=0;e.each(function(e,t){var a=Math.abs(e.getTime()-n.getTime());if(a<r){r=a;i=t}});return i}var w;v.click(function(e){var t=e.clientX-v.offset().left,n=Y(t);s(n);u.data("update-func")(n);clearTimeout(w)});v.mousemove(function(t){var n=t.clientX-v.offset().left,r=Y(n);$("span",g).html(m(e.val(r)));g.css({left:h(r)});p.css({left:a(e.val(r))-10});clearTimeout(w);w=setTimeout(function(){s(r);g.data("last-left",h(r));g.data("last-txt",g.text())},500)});v.mouseleave(function(){g.css({left:g.data("last-left")});p.css({left:g.data("last-left")+30});$("span",g).html(g.data("last-txt"));clearTimeout(w)});u.data("update-func",function(t){p.stop().animate({left:a(e.val(t))-10},500,"expoInOut");var n=h(t),r=m(e.val(t));$("span",g).html(r);g.css({left:n});g.data("last-left",n);g.data("last-txt",r)});return u};return a}return o};t.chart=function(e){var n,r,i,a,u=[],o=[],s;var f={get:function(t,n){var r=t.split("."),i=e;_.each(r,function(e){if(i===undefined){return n}i=i[e]});return _.isUndefined(i)||_.isNull(i)?n:i},set:function(t,n){var r=t.split("."),i=r.pop(),a=e;_.each(r,function(e){if(_.isArray(a[e])&&a[e].length===0){a[e]={}}a=a[e]});if(!_.isEqual(a[i],n)){a[i]=n;_.each(o,function(e){if(_.isFunction(e))e(f,t,n)})}return this},load:function(){var e;e=t.datasource.delimited({url:"data",firstRowIsHeader:f.get("metadata.data.horizontal-header",true),transpose:f.get("metadata.data.transpose",false)});return e.dataset().done(function(e){n=e;_.each(u,function(e){if(_.isFunction(e))e(f)});u=[]})},loaded:function(e){if(n){e(f)}else{u.push(e)}},dataset:function(){return n},theme:function(e){if(arguments.length){r=e;return f}return r},vis:function(e){if(arguments.length){vis=e;return f}return vis},hasHighlight:function(){var e=f.get("metadata.visualize.highlighted-series");return _.isArray(e)&&e.length>0},isHighlighted:function(e){if(_.isUndefined(e)===undefined)return false;var n=this.get("metadata.visualize.highlighted-series"),r=t.utils.name(e);return!_.isArray(n)||n.length===0||_.indexOf(n,r)>=0},locale:function(e){if(arguments.length){s=e;Globalize.culture(s);return f}return s},metricPrefix:function(e){if(arguments.length){a=e;return f}return a},formatValue:function(e,t,n){var r=f.get("metadata.describe.number-format"),i=Number(f.get("metadata.describe.number-divisor")),a=f.get("metadata.describe.number-append","").replace(" ","&nbsp;"),u=f.get("metadata.describe.number-prepend","").replace(" ","&nbsp;");if(i!==0)e=Number(e)/Math.pow(10,i);if(r!="-"){if(n||e==Math.round(e))r=r.substr(0,1)+"0";e=Globalize.format(e,r)}else if(i!==0){e=e.toFixed(1)}return t?u+e+a:e},render:function(e){if(!vis||!r||!n){throw"cannot render the chart!"}vis.setChart(f);vis.render(e)},attributes:function(){return e},onChange:function(e){o.push(e)}};return f}}).call(this);
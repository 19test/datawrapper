(function(){var root=this,dw={};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=dw}exports.dw=dw}else{window.dw=dw}dw.dataset=function(columns,opts){var columnsByName={};_.each(columns,function(col){var origColName=col.name(),colName=origColName,appendix=1;while(columnsByName.hasOwnProperty(colName)){colName=origColName+"."+appendix++}if(colName!=origColName)col.name(colName);columnsByName[colName]=col});opts=_.extend(opts,{});var dataset={columns:function(){return columns},column:function(x){if(_.isString(x)){if(columnsByName[x]!==undefined)return columnsByName[x];throw'No column found with that name: "'+x+'"'}if(columns[x]!==undefined)return columns[x];throw"No series found with that index: "+x},numColumns:function(){return columns.length},numRows:function(){return columns[0].length},eachColumn:function(func){_.each(columns,func)},series:function(x){if(x!==undefined){return dataset.column(x)}return dataset.columns()},eachSeries:function(func){_.each(columns,func)},eachRow:function(func){var i;for(i=0;i<dataset.numRows();i++){func(i)}},rowNames:function(){return columns[0].raw()},rowName:function(i){if(i<0)i+=dataset.numRows();return columns[0].raw()[i]},rowNameLabel:function(){return columns[0].name()},filterRows:function(rows){_.each(columns,function(col){if(rows)col.filterRows(rows);else col.filterRows()})},filterSeries:function(ignore){columns=columns.filter(function(c){return!ignore[c.name()]})},isTimeSeries:function(){return this.__rowDates!==undefined},rowDate:function(i){if(i<0)i+=this.__rowDates.length;return this.__rowDates[i]},rowDates:function(){return this.__rowDates.slice(0)},minMax:function(){return dw.utils.minMax(dataset.columns())}};return dataset};dw.column=function(name,rows,type){function guessType(sample){if(_.every(rows,_.isNumber))return dw.column.types.number();if(_.every(rows,_.isDate))return dw.column.types.date();var types=[dw.column.types.date(sample),dw.column.types.number(sample),dw.column.types.text()],type,k=rows.length,tolerance=.1;_.each(rows,function(val){_.each(types,function(t){t.parse(val)})});_.every(types,function(t){if(t.errors()/k<tolerance)type=t;return!type});return type}var sample=_.map(_.shuffle(_.range(rows.length)).slice(0,200),function(i){return rows[i]});type=type?dw.column.types[type](sample):guessType(sample);var range,total,origRows=rows.slice(0);var column={name:function(){if(arguments.length){name=arguments[0];return column}return name},length:rows.length,val:function(i,unfiltered){if(!arguments.length)return undefined;var r=unfiltered?origRows:rows;if(i<0)i+=r.length;return type.parse(r[i])},values:function(unfiltered){return _.map(unfiltered?origRows:rows,type.parse)},each:function(f){for(i=0;i<rows.length;i++){f(column.val(i),i)}},raw:function(i,val){if(!arguments.length)return rows;if(arguments.length==2){rows[i]=val;return column}return rows[i]},type:function(o){return o?type:type.name()},range:function(){if(!type.toNum)return false;if(!range){range=[Number.MAX_VALUE,-Number.MAX_VALUE];column.each(function(v){v=type.toNum(v);if(v<range[0])range[0]=v;if(v>range[1])range[1]=v});range[0]=type.fromNum(range[0]);range[1]=type.fromNum(range[1])}return range},total:function(){if(!type.toNum)return false;if(!total){total=0;column.each(function(v){total+=type.toNum(v)});total=type.fromNum(total)}return total},filterRows:function(r){rows=[];if(arguments.length){_.each(r,function(i){rows.push(origRows[i])})}else{rows=origRows.slice(0)}column.length=rows.length;range=total=false;return column},toString:function(){return name+" ("+type.name()+")"}};return column};dw.column.types={};dw.column.types.text=function(){return{parse:_.identity,errors:function(){return 0},name:function(){return"text"},formatter:function(){return _.identity}}};dw.column.types.number=function(sample){var format,errors=0,knownFormats={"-.":/^ *-?[0-9]*(\.[0-9]+)? *$/,"-,":/^ *-?[0-9]*(,[0-9]+)? *$/,",.":/^ *-?[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)? *$/,".,":/^ *-?[0-9]{1,3}(\.[0-9]{3})*(,[0-9]+)? *$/," .":/^ *-?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)? *$/," ,":/^ *-?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)? *$/," .":/^ *-?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)? *$/," ,":/^ *-?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)? *$/},naStrings={na:1,"n/a":1,"-":1,":":1};var matches={},bestMatch=["-.",0];sample=sample||[];_.each(sample,function(n){_.each(knownFormats,function(regex,fmt){if(matches[fmt]===undefined)matches[fmt]=0;if(regex.test(n)){matches[fmt]+=1;if(matches[fmt]>bestMatch[1]){bestMatch[0]=fmt;bestMatch[1]=matches[fmt]}}})});format=bestMatch[0];var type={parse:function(raw){if(_.isNumber(raw)||_.isUndefined(raw)||_.isNull(raw))return raw;var number=raw;if(format[0]!="-"){number=number.replace(format[0],"")}if(format[1]!="."){number=number.replace(format[1],".")}if(isNaN(number)){if(!naStrings[number.toLowerCase()]&&number!=="")errors++;return raw}return Number(number)},toNum:function(i){return i},fromNum:function(i){return i},errors:function(){return errors},name:function(){return"number"},formatter:function(config){var format=config["number-format"]||"-",div=Number(config["number-divisor"]||0),append=(config["number-append"]||"").replace(" ","&nbsp;"),prepend=(config["number-prepend"]||"").replace(" ","&nbsp;");return function(val,full,round){if(div!==0)val=Number(val)/Math.pow(10,div);if(format!="-"){if(round||val==Math.round(val))format=format.substr(0,1)+"0";val=Globalize.format(val,format)}else if(div!==0){val=val.toFixed(1)}return full?prepend+val+append:val}}};return type};dw.column.types.date=function(sample){var format,errors=0,matches={},bestMatch=["",0],knownFormats={YYYY:{regex:/^ *([12][0-9]{3}) *$/,precision:"year"},"YYYY-H":{regex:/^ *([12][0-9]{3})[ \-\/]?H([12]) *$/,precision:"month"},"H-YYYY":{regex:/^ *H([12])[ \-\/]([12][0-9]{3}) *$/,precision:"month"},"YYYY-Q":{regex:/^ *([12][0-9]{3})[ \-\/]?Q([1234]) *$/,precision:"quarter"},"Q-YYYY":{regex:/^ *Q([1234])[ \-\/]([12][0-9]{3}) *$/,precision:"quarter"},"YYYY-M":{regex:/^ *([12][0-9]{3}) ?[ -\/\.M](0?[1-9]|1[0-2]) *$/,precision:"month"},"M-YYYY":{regex:/^ *(0?[1-9]|1[0-2]) ?[ -\/\.]([12][0-9]{3}) *$/,precision:"month"},"MM/DD/YYYY":{regex:/^ *(0?[1-9]|1[0-2])([-\/] ?)(0?[1-9]|[1-2][0-9]|3[01])\2([12][0-9]{3})(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,precision:"day"},"DD.MM.YYYY":{regex:/^ *(0?[1-9]|[1-2][0-9]|3[01])([-\.\/ ?])(0?[1-9]|1[0-2])\2([12][0-9]{3})(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,precision:"day"},"YYYY-MM-DD":{regex:/^ *([12][0-9]{3})([-\/\. ?])(0?[1-9]|1[0-2])\2(0?[1-9]|[1-2][0-9]|3[01])(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,precision:"day"}};sample=sample||[];_.each(sample,function(n){_.each(knownFormats,function(format,key){if(matches[key]===undefined)matches[key]=0;if(format.regex.test(n)){matches[key]+=1;if(matches[key]>bestMatch[1]){bestMatch[0]=key;bestMatch[1]=matches[key]}}})});format=bestMatch[0];var type={parse:function(raw){if(_.isDate(raw)||_.isUndefined(raw))return raw;if(!format||!_.isString(raw)){errors++;return raw}var regex=knownFormats[format].regex,m=raw.match(regex);if(!m){errors++;return raw}switch(format){case"YYYY":return new Date(m[1],0,1);case"YYYY-H":return new Date(m[1],(m[2]-1)*6,1);case"H-YYYY":return new Date(m[2],(m[1]-1)*6,1);case"YYYY-Q":return new Date(m[1],(m[2]-1)*3,1);case"Q-YYYY":return new Date(m[2],(m[1]-1)*3,1);case"YYYY-M":return new Date(m[1],m[2]-1,1);case"M-YYYY":return new Date(m[2],m[1]-1,1);case"YYYY-MM-DD":return new Date(m[1],m[3]-1,m[4],m[5]||0,m[6]||0,m[7]||0);case"DD.MM.YYYY":return new Date(m[4],m[3]-1,m[1],m[5]||0,m[6]||0,m[7]||0);case"MM/DD/YYYY":return new Date(m[4],m[1]-1,m[3],m[5]||0,m[6]||0,m[7]||0)}errors++;return raw},toNum:function(d){return d.getTime()},fromNum:function(i){return new Date(i)},errors:function(){return errors},name:function(){return"date"},format:function(){return format},precision:function(){return knownFormats[format].precision},formatter:function(config){switch(knownFormats[format].precision){case"year":return function(d){return d.getFullYear()};case"quarter":return function(d){return d.getFullYear()+" Q"+(d.getMonth()/3+1)};case"month":return function(d){return Globalize.format(d,"MMM yy")};case"day":return function(d){return Globalize.format(d,"d")}}}};return type};dw.datasource={};dw.datasource.delimited=function(opts){function loadAndParseCsv(){if(opts.url){return $.ajax({url:opts.url,method:"GET",dataType:"text"}).then(function(raw){return new DelimitedParser(opts).parse(raw)})}else if(opts.csv){var dfd=$.Deferred(),parsed=dfd.then(function(raw){return new DelimitedParser(opts).parse(raw)});dfd.resolve(opts.csv);return parsed}throw"you need to provide either an URL or CSV data."}var delimited={dataset:loadAndParseCsv};return delimited};var DelimitedParser=function(opts){opts=_.extend({delimiter:"auto",quoteChar:'"',skipRows:0,emptyValue:null,transpose:false,firstRowIsHeader:true},opts);this.__delimiterPatterns=getDelimiterPatterns(opts.delimiter,opts.quoteChar);this.opts=opts};function getDelimiterPatterns(delimiter,quoteChar){return new RegExp("(\\"+delimiter+"|\\r?\\n|\\r|^)"+"(?:"+quoteChar+"([^"+quoteChar+"]*(?:"+quoteChar+'"[^'+quoteChar+"]*)*)"+quoteChar+"|"+"([^"+quoteChar+"\\"+delimiter+"\\r\\n]*))","gi")}_.extend(DelimitedParser.prototype,{parse:function(data){var me=this,opts=this.opts;me.__rawData=data;if(opts.delimiter=="auto"){opts.delimiter=me.guessDelimiter(data,opts.skipRows);me.__delimiterPatterns=getDelimiterPatterns(opts.delimiter,opts.quoteChar)}var columns=[],closure=opts.delimiter!="|"?"|":"#",arrData;data=closure+data.replace(/\s+$/g,"")+closure;function parseCSV(delimiterPattern,strData,strDelimiter){strDelimiter=strDelimiter||",";var arrData=[[]];var arrMatches=null,strMatchedValue;while(arrMatches=delimiterPattern.exec(strData)){var strMatchedDelimiter=arrMatches[1];if(strMatchedDelimiter.length&&strMatchedDelimiter!=strDelimiter){arrData.push([])}if(arrMatches[2]){strMatchedValue=arrMatches[2].replace(new RegExp('""',"g"),'"')}else{strMatchedValue=arrMatches[3]}arrData[arrData.length-1].push(strMatchedValue)}if(arrData[0][0].substr(0,1)==closure){arrData[0][0]=arrData[0][0].substr(1)}var p=arrData.length-1,q=arrData[p].length-1,r=arrData[p][q].length-1;if(arrData[p][q].substr(r)==closure){arrData[p][q]=arrData[p][q].substr(0,r)}return arrData}function transpose(arrMatrix){var a=arrMatrix,w=a.length?a.length:0,h=a[0]instanceof Array?a[0].length:0;if(h===0||w===0){return[]}var i,j,t=[];for(i=0;i<h;i++){t[i]=[];for(j=0;j<w;j++){t[i][j]=a[j][i]}}return t}function makeDataset(arrData){var columns=[],columnNames={},rowCount=arrData.length,columnCount=arrData[0].length,rowIndex=opts.skipRows;var srcColumns=[];if(opts.firstRowIsHeader){srcColumns=arrData[rowIndex];rowIndex++}for(var c=0;c<columnCount;c++){var col=_.isString(srcColumns[c])?srcColumns[c].replace(/^\s+|\s+$/g,""):"",suffix=col!==""?"":1;col=col!==""?col:"X.";while(columnNames[col+suffix]!==undefined){suffix=suffix===""?1:suffix+1}columns.push({name:col+suffix,data:[]});columnNames[col+suffix]=true}_.each(_.range(rowIndex,rowCount),function(row){_.each(columns,function(c,i){c.data.push(arrData[row][i]!==""?arrData[row][i]:opts.emptyValue)})});columns=_.map(columns,function(c){return dw.column(c.name,c.data)});return dw.dataset(columns)}arrData=parseCSV(this.__delimiterPatterns,data,opts.delimiter);if(opts.transpose){arrData=transpose(arrData)}return makeDataset(arrData)},guessDelimiter:function(strData){var maxMatchCount=0,k=-1,me=this,delimiters=["	",";","|",","];_.each(delimiters,function(delimiter,i){var regex=getDelimiterPatterns(delimiter,me.quoteChar),c=strData.match(regex).length;if(c>maxMatchCount){maxMatchCount=c;k=i}});return delimiters[k]}});dw.utils={minMax:function(columns){var minmax=[Number.MAX_VALUE,-Number.MAX_VALUE];_.each(columns,function(column){minmax[0]=Math.min(minmax[0],column.range()[0]);minmax[1]=Math.max(minmax[1],column.range()[1])});return minmax},dateFormat:function(daysDelta){var new_month=true,last_date=false;function timeFormat(formats){return function(date){new_month=last_date&&date.getMonth()!=last_date.getMonth();last_date=date;var i=formats.length-1,f=formats[i];while(!f[1](date))f=formats[--i];return f[0](date)}}return timeFormat([[d3.time.format("%Y"),function(){return true}],[d3.time.format(daysDelta>70?"%b":"%B"),function(d){return d.getMonth()!==0}],[d3.time.format("%d"),function(d){return d.getDate()!=1}],[d3.time.format(daysDelta>70?"%b %d":"%B %d"),function(d){return d.getDate()!=1&&new_month}],[d3.time.format("%I %p"),function(d){return d.getHours()}],[d3.time.format("%I:%M"),function(d){return d.getMinutes()}],[d3.time.format(":%S"),function(d){return d.getSeconds()}],[d3.time.format(".%L"),function(d){return d.getMilliseconds()}]])},longDateFormat:function(column){var me=this;return function(d){if(column.type()=="date"){switch(column.type(true).precision()){case"year":return d.getFullYear();case"quarter":return d.getFullYear()+" Q"+(d.getMonth()/3+1);case"month":return Globalize.format(d,"MMM yy");case"day":return Globalize.format(d,"d")}}else{return d}}},columnNameColumn:function(columns){var names=_.map(columns,function(col){return col.name()});return dw.column("",names)},name:function(obj){return _.isFunction(obj.name)?obj.name():_.isString(obj.name)?obj.name:obj},getMaxChartHeight:function(el){function margin(el,type){if($(el).css("margin-"+type)=="auto")return 0;return+$(el).css("margin-"+type).replace("px","")}var ch=0,bottom=0;$("body > *").each(function(i,el){var t=el.tagName.toLowerCase();if(t!="script"&&el.id!="chart"&&!$(el).hasClass("tooltip")&&!$(el).hasClass("container")&&!$(el).hasClass("noscript")){ch+=$(el).outerHeight(false)}ch+=Math.max(margin(el,"top"),bottom);bottom=margin(el,"bottom")});ch+=bottom;var mt=$("#chart").css("margin-top").replace("px",""),mb=$("#chart").css("margin-bottom").replace("px",""),maxH=$(window).height()-ch-8;if(!$.support.leadingWhitespace)maxH-=15;maxH-=$("body").css("padding-top").replace("px","");maxH-=$("body").css("padding-bottom").replace("px","");return maxH}};dw.utils.filter=function(column,active,type,format){var callbacks=[],lastActiveRow;type=type||"auto";format=format||_.identity;if(type=="auto"){if(column.type()=="date")type="timescale";else if(column.type()=="text")type=column.length<6?"buttons":"select"}var filter={ui:getFilterUI(type),change:function(callback){callbacks.push(callback)}};function update(i){_.each(callbacks,function(cb){if(_.isFunction(cb)){cb(column.val(i),i)}})}function getFilterUI(type){var f;if(column.length<2)return function(){return false};if(type=="select")f=function(vis){var select=$("<select />");column.each(function(val,i){var lbl=format(val);if(!lbl)return;select.append('<option value="'+i+'">'+(_.isString(lbl)?$.trim(lbl):lbl)+"</option>")});select.change(function(evt){var cur=select.val();update(cur)});select.addClass("filter-ui filter-select");return select};if(type=="buttons")f=function(vis){var div=$("<div />");div.addClass("filter-ui filter-links");column.each(function(val,i){var lbl=format(val);if(!lbl)return;var a=$('<a href="#'+i+'"'+(i==active?' class="active" ':"")+">"+(_.isString(lbl)?$.trim(lbl):lbl)+"</a>").data("row",i);div.append(a)});$("a",div).click(function(e){var a=$(e.target);e.preventDefault();if(a.hasClass("active"))return;$("a",div).removeClass("active");a.addClass("active");update(a.data("row"))});div.appendTo("body");var fy=$("a:first",div).offset().top,ly=$("a:last",div).offset().top;if(fy!=ly)return getFilterUI("select")(vis);return div};if(type=="timescale")f=function(vis){var w=Math.min(vis.__w-30,Math.max(300,vis.__w*.7)),timescale=d3.time.scale().domain([column.val(0),column.val(-1)]).range([0,w]),timesel=$("<div></div>").css({position:"relative",height:45,"margin-left":3}).addClass("filter-ui"),nticks=w/80,ticks=timescale.ticks(nticks),daysDelta=Math.round((column.val(-1).getTime()-column.val(0).getTime())/864e5),fmt=dw.utils.dateFormat(daysDelta),lfmt=dw.utils.longDateFormat(column),dots=timescale.ticks(w/8),lbl_x=function(i){return Math.max(-18,timescale(column.val(i))-40)};_.each(ticks,function(d){var s=$("<span>"+fmt(d)+"</span>"),x=timescale(d)-40,lw=vis.labelWidth(fmt(d));if(40-lw*.5+x<0)x=-40+.5*lw;s.css({position:"absolute",top:0,width:80,left:x,"text-align":"center",opacity:.55});timesel.append(s)});_.each(dots,function(d){if(d.getTime()<column.val(0).getTime()||d.getTime()>column.val(-1).getTime())return;var s=$('<span class="dot"></span>');s.css({position:"absolute",bottom:19,width:1,height:"1ex","border-left":"1px solid #000","vertical-align":"bottom",left:Math.round(timescale(d))+.5});if(!_.find(ticks,function(td){return d.getTime()==td.getTime()})){s.css({height:"0.6ex",opacity:.5})}timesel.append(s)});var pointer=$("<div>▲</div>").css({position:"absolute",width:20,bottom:2,left:timescale(column.val(active))-9,"text-align":"center"});timesel.append(pointer);var lbl=$("<div><span></span></div>").css({position:"absolute",width:80,top:0,left:lbl_x(active),"text-align":"center"}).data("last-txt",lfmt(column.val(active))).data("last-left",lbl_x(active));$("span",lbl).css({background:vis.theme.colors.background,"font-weight":"bold",padding:"0 1ex"}).html(lfmt(column.val(active)));timesel.append(lbl);$("<div />").css({position:"absolute",width:w+1,bottom:15,height:2,"border-bottom":"1px solid #000"}).appendTo(timesel);var bar=$("<div />").css({position:"absolute",left:0,width:w,height:40});timesel.append(bar);function nearest(rel_x){var x_date=timescale.invert(rel_x),min_dist=Number.MAX_VALUE,nearest_row=0;column.each(function(date,i){var dist=Math.abs(date.getTime()-x_date.getTime());if(dist<min_dist){min_dist=dist;nearest_row=i}});return nearest_row}var autoClickTimer;bar.click(function(evt){var rel_x=evt.clientX-bar.offset().left,nearest_row=nearest(rel_x);update(nearest_row);timesel.data("update-func")(nearest_row);clearTimeout(autoClickTimer)});bar.mousemove(function(evt){var rel_x=evt.clientX-bar.offset().left,nearest_row=nearest(rel_x);$("span",lbl).html(lfmt(column.val(nearest_row)));lbl.css({left:lbl_x(nearest_row)});pointer.css({left:timescale(column.val(nearest_row))-10});clearTimeout(autoClickTimer);autoClickTimer=setTimeout(function(){update(nearest_row);lbl.data("last-left",lbl_x(nearest_row));lbl.data("last-txt",lbl.text())},500)});bar.mouseleave(function(){lbl.css({left:lbl.data("last-left")});pointer.css({left:lbl.data("last-left")+30});$("span",lbl).html(lbl.data("last-txt"));clearTimeout(autoClickTimer)});timesel.data("update-func",function(i){pointer.stop().animate({left:timescale(column.val(i))-10},500,"expoInOut");var l_x=lbl_x(i),lbl_txt=lfmt(column.val(i));$("span",lbl).html(lbl_txt);lbl.css({left:l_x});lbl.data("last-left",l_x);lbl.data("last-txt",lbl_txt)});return timesel};return f}return filter};dw.chart=function(attributes){var dataset,theme,visualization,metric_prefix,load_callbacks=$.Callbacks(),change_callbacks=$.Callbacks(),locale;var chart={get:function(key,_default){var keys=key.split("."),pt=attributes;_.each(keys,function(key){if(pt===undefined){return _default}pt=pt[key]});return _.isUndefined(pt)||_.isNull(pt)?_default:pt},set:function(key,value){var keys=key.split("."),lastKey=keys.pop(),pt=attributes;_.each(keys,function(key){if(_.isUndefined(pt[key])){pt[key]={}}pt=pt[key]});if(!_.isEqual(pt[lastKey],value)){pt[lastKey]=value;change_callbacks.fire(chart,key,value)}return this},load:function(){var datasource;datasource=dw.datasource.delimited({url:"data",firstRowIsHeader:chart.get("metadata.data.horizontal-header",true),transpose:chart.get("metadata.data.transpose",false)});return datasource.dataset().done(function(ds){dataset=ds;load_callbacks.fire(chart)})},loaded:function(callback){if(dataset){callback(chart)}else{load_callbacks.add(callback)}},dataset:function(){return dataset},theme:function(_theme){if(arguments.length){theme=_theme;return chart}return theme},vis:function(_vis){if(arguments.length){vis=_vis;vis.setChart(chart);return chart}return vis},hasHighlight:function(){var hl=chart.get("metadata.visualize.highlighted-series");return _.isArray(hl)&&hl.length>0},isHighlighted:function(obj){if(_.isUndefined(obj)===undefined)return false;var hl=this.get("metadata.visualize.highlighted-series"),obj_name=dw.utils.name(obj);return!_.isArray(hl)||hl.length===0||_.indexOf(hl,obj_name)>=0},locale:function(_locale){if(arguments.length){locale=_locale;Globalize.culture(locale);return chart}return locale},metricPrefix:function(_metric_prefix){if(arguments.length){metric_prefix=_metric_prefix;return chart}return metric_prefix},formatValue:function(val,full,round){var format=chart.get("metadata.describe.number-format"),div=Number(chart.get("metadata.describe.number-divisor")),append=chart.get("metadata.describe.number-append","").replace(" ","&nbsp;"),prepend=chart.get("metadata.describe.number-prepend","").replace(" ","&nbsp;");if(div!==0)val=Number(val)/Math.pow(10,div);if(format!="-"){if(round||val==Math.round(val))format=format.substr(0,1)+"0";val=Globalize.format(val,format)}else if(div!==0){val=val.toFixed(1)}return full?prepend+val+append:val},render:function(container){if(!vis||!theme||!dataset){throw"cannot render the chart!"}vis.setChart(chart);vis.__init();vis.render($(container))},attributes:function(attrs){if(arguments.length){attributes=attrs;return chart}return attributes},onChange:change_callbacks.add,columnFormatter:function(column){var colFormat=chart.get("metadata.describe.column-format",{});return column.type(true).formatter(colFormat[column.name()]||{})}};return chart};dw.visualization=function(){var __vis={};var visualization=function(id){return new __vis[id]};visualization.register=function(id){var parent=arguments.length==3?__vis[arguments[1]].prototype:dw.visualization.base,props=arguments[arguments.length-1],vis=__vis[id]=function(){};_.extend(vis.prototype,parent,props)};return visualization}();dw.visualization.base=function(){}.prototype;_.extend(dw.visualization.base,{__init:function(){this.__renderedDfd=$.Deferred()},render:function(el){$(el).html("implement me!")},setTheme:function(theme){if(!theme)return this;this.theme=theme;var attr_properties=["horizontalGrid","verticalGrid","yAxis","xAxis"];_.each(attr_properties,function(prop){if(theme.hasOwnProperty(prop)){for(var key in theme[prop]){var lkey=key.replace(/([A-Z])/g,"-$1").toLowerCase();if(!theme[prop].hasOwnProperty(lkey)){theme[prop][lkey]=theme[prop][key]}}}});return this},setSize:function(width,height){var me=this;me.__w=width;me.__h=height;return me},get:function(str,_default){return this.chart.get("metadata.visualize."+str,_default)},warn:function(str){var warning=$("<div>"+str+"</div>");warning.css({"background-color":"#FCF8E3",border:"1px solid #FBEED5","border-radius":"4px 4px 4px 4px",color:"#a07833","margin-bottom":"18px",padding:"8px 35px 8px 14px","text-shadow":"0 1px 0 rgba(255, 255, 255, 0.5)",left:"10%",right:"10%","z-index":1e3,"text-align":"center",position:"absolute"});$("body").prepend(warning);warning.hide();warning.fadeIn()},signature:function(){},translate:function(str){var locale=this.meta.locale,lang=this.lang;return locale[str]?locale[str][lang]||locale[str]:str},checkBrowserCompatibility:function(){return true},setChart:function(chart){var me=this;me.dataset=chart.dataset();me.setTheme(chart.theme());me.chart=chart;me.dataset.filterSeries(chart.get("metadata.data.ignore-columns",{}))},axes:function(returnAsColumns){var me=this,dataset=me.dataset,usedColumns={},defAxes={},errors=[];_.each(me.meta.axes,function(axisDef,key){function checkColumn(col){return!usedColumns[col.name()]&&_.indexOf(axisDef.accepts,col.type())>=0}if(!axisDef.optional){if(!axisDef.multiple){var c=_.find(dataset.columns(),checkColumn);if(c){usedColumns[c.name()]=true;defAxes[key]=c.name()}else{errors.push("Error: Could not populate axis <b>"+key+"</b> a data column of the type "+axisDef.accepts)}}else{defAxes[key]=[];dataset.eachColumn(function(c){if(checkColumn(c)){usedColumns[c.name()]=true;defAxes[key].push(c.name())}});if(!defAxes[key].length){errors.push("Error: Could not populate axis <b>"+key+"</b> with a column of the type "+axisDef.accepts)}}}else{defAxes[key]=false}});if(errors.length){me.warn(errors.join("<br/>"));return false}defAxes=me.chart.get("metadata.axes",defAxes);if(returnAsColumns){_.each(defAxes,function(columns,key){if(!_.isArray(columns)){defAxes[key]=columns!==false?me.dataset.column(columns):null}else{_.each(columns,function(column,i){defAxes[key][i]=column!==false?me.dataset.column(column):null})}})}return defAxes},keys:function(){var me=this,axesDef=me.axes();if(axesDef.labels){var lblCol=me.dataset.column(axesDef.labels),fmt=dw.utils.longDateFormat(lblCol),keys=[];lblCol.each(function(val){keys.push(String(fmt(val)))});return keys}return[]},reset:function(){this.clear();$("#chart").html("").off("click").off("mousemove").off("mouseenter").off("mouseover");$(".chart .filter-ui").remove();$(".chart .legend").remove()},clear:function(){},renderingComplete:function(){this.__renderedDfd.resolve()},rendered:function(){return this.__renderedDfd.promise()}});dw.theme=function(){var __themes={};var theme=function(id){return __themes[id]};theme.register=function(id){var parent=arguments.length==3?__themes[arguments[1]]:dw.theme.base,props=arguments[arguments.length-1];__themes[id]=$.extend(true,{},parent,props)};return theme}();dw.theme.base={colors:{palette:["#6E7DA1","#64A4C4","#53CCDD","#4EF4E8"],secondary:["#000000","#777777","#cccccc","#ffd500","#6FAA12"],positive:"#85B4D4",negative:"#E31A1C",background:"#ffffff",text:"#000000"},padding:{left:0,right:20,bottom:30,top:10},lineChart:{strokeWidth:3,maxLabelWidth:80,fillOpacity:.2,xLabelOffset:20},columnChart:{cutGridLines:false,barAttrs:{"stroke-width":1},darkenStroke:18},barChart:{barAttrs:{"stroke-width":1}},xAxis:{stroke:"#333"},yAxis:{strokeWidth:1},horizontalGrid:{stroke:"#d9d9d9"},verticalGrid:false,frame:false,frameStrokeOnTop:false,yTicks:false,hover:true,tooltip:true,hpadding:0,vpadding:10,minWidth:400,locale:"de_DE",duration:1e3,easing:"expoInOut"}}).call(this);
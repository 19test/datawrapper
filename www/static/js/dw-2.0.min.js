(function(){var e=this,t={};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=t}exports.dw=t}else{window.dw=t}t.dataset=function(e,n){var r={};_.each(e,function(e){var t=e.name(),n=t,a=1;while(r.hasOwnProperty(n)){n=t+"."+a++}if(n!=t)e.name(n);r[n]=e});n=_.extend(n,{});var a={columns:function(){return e},column:function(t){if(_.isString(t)){if(r[t]!==undefined)return r[t];throw'No column found with that name: "'+t+'"'}if(e[t]!==undefined)return e[t];throw"No series found with that index: "+t},numColumns:function(){return e.length},numRows:function(){return e[0].length},eachColumn:function(t){_.each(e,t)},series:function(e){if(e!==undefined){return a.column(e)}return a.columns()},eachSeries:function(t){_.each(e,t)},eachRow:function(e){var t;for(t=0;t<a.numRows();t++){e(t)}},rowNames:function(){return e[0].raw()},rowName:function(t){if(t<0)t+=a.numRows();return e[0].raw()[t]},rowNameLabel:function(){return e[0].name()},filterRows:function(t){_.each(e,function(e){if(t)e.filterRows(t);else e.filterRows()})},filterSeries:function(t){e=e.filter(function(e){return!t[e.name()]})},isTimeSeries:function(){return this.__rowDates!==undefined},rowDate:function(e){if(e<0)e+=this.__rowDates.length;return this.__rowDates[e]},rowDates:function(){return this.__rowDates.slice(0)},minMax:function(){return t.utils.minMax(a.columns())}};return a};t.column=function(e,n,r){function a(e){if(_.every(n,_.isNumber))return t.column.types.number();if(_.every(n,_.isDate))return t.column.types.date();var r=[t.column.types.date(e),t.column.types.number(e),t.column.types.text()],a,i=n.length,u=.1;_.each(n,function(e){_.each(r,function(t){t.parse(e)})});_.every(r,function(e){if(e.errors()/i<u)a=e;return!a});return a}var u=_.map(_.shuffle(_.range(n.length)).slice(0,200),function(e){return n[e]});r=r?t.column.types[r](u):a(u);var o,s,c=n.slice(0);var f={name:function(){if(arguments.length){e=arguments[0];return f}return e},length:n.length,val:function(e,t){if(!arguments.length)return undefined;var a=t?c:n;if(e<0)e+=a.length;return r.parse(a[e])},values:function(e){return _.map(e?c:n,r.parse)},each:function(e){for(i=0;i<n.length;i++){e(f.val(i),i)}},raw:function(e){if(!arguments.length)return n;return n[e]},type:function(e){return e?r:r.name()},range:function(){if(!r.toNum)return false;if(!o){o=[Number.MAX_VALUE,-Number.MAX_VALUE];f.each(function(e){e=r.toNum(e);if(e<o[0])o[0]=e;if(e>o[1])o[1]=e});o[0]=r.fromNum(o[0]);o[1]=r.fromNum(o[1])}return o},total:function(){if(!r.toNum)return false;if(!s){s=0;f.each(function(e){s+=r.toNum(e)});s=r.fromNum(s)}return s},filterRows:function(e){n=[];if(arguments.length){_.each(e,function(e){n.push(c[e])})}else{n=c.slice(0)}f.length=n.length;o=s=false;return f},toString:function(){return e+" ("+r.name()+")"}};return f};t.column.types={};t.column.types.text=function(){return{parse:function(e){return e},errors:function(){return 0},name:function(){return"text"}}};t.column.types.number=function(e){var t,n=0,r={"-.":/^ *-?[0-9]*(\.[0-9]+)? *$/,"-,":/^ *-?[0-9]*(,[0-9]+)? *$/,",.":/^ *-?[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)? *$/,".,":/^ *-?[0-9]{1,3}(\.[0-9]{3})*(,[0-9]+)? *$/," .":/^ *-?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)? *$/," ,":/^ *-?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)? *$/," .":/^ *-?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)? *$/," ,":/^ *-?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)? *$/},a={na:1,"n/a":1,"-":1,":":1};var i={},u=["-.",0];e=e||[];_.each(e,function(e){_.each(r,function(t,n){if(i[n]===undefined)i[n]=0;if(t.test(e)){i[n]+=1;if(i[n]>u[1]){u[0]=n;u[1]=i[n]}}})});t=u[0];var o={parse:function(e){if(_.isNumber(e)||_.isUndefined(e)||_.isNull(e))return e;var r=e;if(t[0]!="-"){r=r.replace(t[0],"")}if(t[1]!="."){r=r.replace(t[1],".")}if(isNaN(r)){if(!a[r]&&r!=="")n++;return e}return Number(r)},toNum:function(e){return e},fromNum:function(e){return e},errors:function(){return n},name:function(){return"number"}};return o};t.column.types.date=function(e){var t,n=0,r={},a=["",0],i={YYYY:{regex:/^ *([12][0-9]{3}) *$/,precision:"year"},"YYYY-H":{regex:/^ *([12][0-9]{3})[ \-\/]?H([12]) *$/,precision:"month"},"H-YYYY":{regex:/^ *H([12])[ \-\/]([12][0-9]{3}) *$/,precision:"month"},"YYYY-Q":{regex:/^ *([12][0-9]{3})[ \-\/]?Q([1234]) *$/,precision:"quarter"},"Q-YYYY":{regex:/^ *Q([1234])[ \-\/]([12][0-9]{3}) *$/,precision:"quarter"},"YYYY-M":{regex:/^ *([12][0-9]{3}) ?[ -\/\.M](0?[1-9]|1[0-2]) *$/,precision:"month"},"M-YYYY":{regex:/^ *(0?[1-9]|1[0-2]) ?[ -\/\.]([12][0-9]{3}) *$/,precision:"month"},"MM/DD/YYYY":{regex:/^ *(0?[1-9]|1[0-2])([-\/] ?)(0?[1-9]|[1-2][0-9]|3[01])\2([12][0-9]{3})(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,precision:"day"},"DD.MM.YYYY":{regex:/^ *(0?[1-9]|[1-2][0-9]|3[01])([-\.\/ ?])(0?[1-9]|1[0-2])\2([12][0-9]{3})(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,precision:"day"},"YYYY-MM-DD":{regex:/^ *([12][0-9]{3})([-\/\. ?])(0?[1-9]|1[0-2])\2(0?[1-9]|[1-2][0-9]|3[01])(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,precision:"day"}};e=e||[];_.each(e,function(e){_.each(i,function(t,n){if(r[n]===undefined)r[n]=0;if(t.regex.test(e)){r[n]+=1;if(r[n]>a[1]){a[0]=n;a[1]=r[n]}}})});t=a[0];var u={parse:function(e){if(_.isDate(e)||_.isUndefined(e))return e;if(!t||!_.isString(e)){n++;return e}var r=i[t].regex,a=e.match(r);if(!a){n++;return e}switch(t){case"YYYY":return new Date(a[1],0,1);case"YYYY-H":return new Date(a[1],(a[2]-1)*6,1);case"H-YYYY":return new Date(a[2],(a[1]-1)*6,1);case"YYYY-Q":return new Date(a[1],(a[2]-1)*3,1);case"Q-YYYY":return new Date(a[2],(a[1]-1)*3,1);case"YYYY-M":return new Date(a[1],a[2]-1,1);case"M-YYYY":return new Date(a[2],a[1]-1,1);case"YYYY-MM-DD":return new Date(a[1],a[3]-1,a[4],a[5]||0,a[6]||0,a[7]||0);case"DD.MM.YYYY":return new Date(a[4],a[3]-1,a[1],a[5]||0,a[6]||0,a[7]||0);case"MM/DD/YYYY":return new Date(a[4],a[1]-1,a[3],a[5]||0,a[6]||0,a[7]||0)}n++;return e},toNum:function(e){return e.getTime()},fromNum:function(e){return new Date(e)},errors:function(){return n},name:function(){return"date"},format:function(){return t},precision:function(){return i[t].precision}};return u};t.datasource={};t.datasource.delimited=function(e){function t(){if(e.url){return $.ajax({url:e.url,method:"GET",dataType:"text"}).then(function(t){return new n(e).parse(t)})}else if(e.csv){var t=$.Deferred(),r=t.then(function(t){return new n(e).parse(t)});t.resolve(e.csv);return r}throw"you need to provide either an URL or CSV data."}var r={dataset:t};return r};var n=function(e){e=_.extend({delimiter:"auto",quoteChar:'"',skipRows:0,emptyValue:null,transpose:false,firstRowIsHeader:true},e);this.__delimiterPatterns=r(e.delimiter,e.quoteChar);this.opts=e};function r(e,t){return new RegExp("(\\"+e+"|\\r?\\n|\\r|^)"+"(?:"+t+"([^"+t+"]*(?:"+t+'"[^'+t+"]*)*)"+t+"|"+"([^"+t+"\\"+e+"\\r\\n]*))","gi")}_.extend(n.prototype,{parse:function(e){var n=this,a=this.opts;n.__rawData=e;if(a.delimiter=="auto"){a.delimiter=n.guessDelimiter(e,a.skipRows);n.__delimiterPatterns=r(a.delimiter,a.quoteChar)}var i=[],u=a.delimiter!="|"?"|":"#",o;e=u+e.replace(/\s+$/g,"")+u;function s(e,t,n){n=n||",";var r=[[]];var a=null,i;while(a=e.exec(t)){var o=a[1];if(o.length&&o!=n){r.push([])}if(a[2]){i=a[2].replace(new RegExp('""',"g"),'"')}else{i=a[3]}r[r.length-1].push(i)}if(r[0][0].substr(0,1)==u){r[0][0]=r[0][0].substr(1)}var s=r.length-1,c=r[s].length-1,f=r[s][c].length-1;if(r[s][c].substr(f)==u){r[s][c]=r[s][c].substr(0,f)}return r}function c(e){var t=e,n=t.length?t.length:0,r=t[0]instanceof Array?t[0].length:0;if(r===0||n===0){return[]}var a,i,u=[];for(a=0;a<r;a++){u[a]=[];for(i=0;i<n;i++){u[a][i]=t[i][a]}}return u}function f(e){var n=[],r={},i=e.length,u=e[0].length,o=a.skipRows;var s=[];if(a.firstRowIsHeader){s=e[o];o++}for(var c=0;c<u;c++){var f=_.isString(s[c])?s[c].replace(/^\s+|\s+$/g,""):"",l=f!==""?"":1;f=f!==""?f:"X.";while(r[f+l]!==undefined){l=l===""?1:l+1}n.push({name:f+l,data:[]});r[f+l]=true}_.each(_.range(o,i),function(t){_.each(n,function(n,r){n.data.push(e[t][r]!==""?e[t][r]:a.emptyValue)})});n=_.map(n,function(e){return t.column(e.name,e.data)});return t.dataset(n)}o=s(this.__delimiterPatterns,e,a.delimiter);if(a.transpose){o=c(o)}return f(o)},guessDelimiter:function(e){var t=0,n=-1,a=this,i=["	",";","|",","];_.each(i,function(i,u){var o=r(i,a.quoteChar),s=e.match(o).length;if(s>t){t=s;n=u}});return i[n]}});t.utils={minMax:function(e){var t=[Number.MAX_VALUE,-Number.MAX_VALUE];_.each(e,function(e){t[0]=Math.min(t[0],e.range()[0]);t[1]=Math.max(t[1],e.range()[1])});return t},dateFormat:function(e){var t=true,n=false;function r(e){return function(r){t=n&&r.getMonth()!=n.getMonth();n=r;var a=e.length-1,i=e[a];while(!i[1](r))i=e[--a];return i[0](r)}}return r([[d3.time.format("%Y"),function(){return true}],[d3.time.format(e>70?"%b":"%B"),function(e){return e.getMonth()!==0}],[d3.time.format("%d"),function(e){return e.getDate()!=1}],[d3.time.format(e>70?"%b %d":"%B %d"),function(e){return e.getDate()!=1&&t}],[d3.time.format("%I %p"),function(e){return e.getHours()}],[d3.time.format("%I:%M"),function(e){return e.getMinutes()}],[d3.time.format(":%S"),function(e){return e.getSeconds()}],[d3.time.format(".%L"),function(e){return e.getMilliseconds()}]])},longDateFormat:function(e){var t=this;return function(t){if(e.type()=="date"){switch(e.type(true).precision()){case"year":return t.getFullYear();case"quarter":return t.getFullYear()+" Q"+(t.getMonth()/3+1);case"month":return Globalize.format(t,"MMM yy");case"day":return Globalize.format(t,"d")}}else{return t}}},columnNameColumn:function(e){var n=_.map(e,function(e){return e.name()});return t.column("",n)},name:function(e){return _.isFunction(e.name)?e.name():_.isString(e.name)?e.name:e},getMaxChartHeight:function(e){function t(e,t){if($(e).css("margin-"+t)=="auto")return 0;return+$(e).css("margin-"+t).replace("px","")}var n=0,r=0;$("body > *").each(function(e,a){var i=a.tagName.toLowerCase();if(i!="script"&&a.id!="chart"&&!$(a).hasClass("tooltip")&&!$(a).hasClass("container")&&!$(a).hasClass("noscript")){n+=$(a).outerHeight(false)}n+=Math.max(t(a,"top"),r);r=t(a,"bottom")});n+=r;var a=$("#chart").css("margin-top").replace("px",""),i=$("#chart").css("margin-bottom").replace("px",""),u=$(window).height()-n-8;if(!$.support.leadingWhitespace)u-=15;u-=$("body").css("padding-top").replace("px","");u-=$("body").css("padding-bottom").replace("px","");return u}};t.utils.filter=function(e,n,r,a){var i=[],u;r=r||"auto";a=a||_.identity;if(r=="auto"){if(e.type()=="date")r="timescale";else if(e.type()=="text")r=e.length<6?"buttons":"select"}var o={ui:c(r),change:function(e){i.push(e)}};function s(t){_.each(i,function(n){if(_.isFunction(n)){n(e.val(t),t)}})}function c(r){var i;if(e.length<2)return function(){return false};if(r=="select")i=function(t){var n=$("<select />");e.each(function(e,t){var r=a(e);if(!r)return;n.append('<option value="'+t+'">'+(_.isString(r)?$.trim(r):r)+"</option>")});n.change(function(e){var t=n.val();s(t)});n.addClass("filter-ui filter-select");return n};if(r=="buttons")i=function(t){var r=$("<div />");r.addClass("filter-ui filter-links");e.each(function(e,t){var i=a(e);if(!i)return;var u=$('<a href="#'+t+'"'+(t==n?' class="active" ':"")+">"+(_.isString(i)?$.trim(i):i)+"</a>").data("row",t);r.append(u)});$("a",r).click(function(e){var t=$(e.target);e.preventDefault();if(t.hasClass("active"))return;$("a",r).removeClass("active");t.addClass("active");s(t.data("row"))});r.appendTo("body");var i=$("a:first",r).offset().top,u=$("a:last",r).offset().top;r.remove();if(i!=u)return c("select")(t);return r};if(r=="timescale")i=function(r){var a=Math.min(r.__w-30,Math.max(300,r.__w*.7)),i=d3.time.scale().domain([e.val(0),e.val(-1)]).range([0,a]),u=$("<div></div>").css({position:"relative",height:45,"margin-left":3}).addClass("filter-ui"),o=a/80,c=i.ticks(o),f=Math.round((e.val(-1).getTime()-e.val(0).getTime())/864e5),l=t.utils.dateFormat(f),m=t.utils.longDateFormat(e),d=i.ticks(a/8),h=function(t){return Math.max(-18,i(e.val(t))-40)};_.each(c,function(e){var t=$("<span>"+l(e)+"</span>"),n=i(e)-40,a=r.labelWidth(l(e));if(40-a*.5+n<0)n=-40+.5*a;t.css({position:"absolute",top:0,width:80,left:n,"text-align":"center",opacity:.55});u.append(t)});_.each(d,function(t){if(t.getTime()<e.val(0).getTime()||t.getTime()>e.val(-1).getTime())return;var n=$('<span class="dot"></span>');n.css({position:"absolute",bottom:19,width:1,height:"1ex","border-left":"1px solid #000","vertical-align":"bottom",left:Math.round(i(t))+.5});if(!_.find(c,function(e){return t.getTime()==e.getTime()})){n.css({height:"0.6ex",opacity:.5})}u.append(n)});var p=$("<div>▲</div>").css({position:"absolute",width:20,bottom:2,left:i(e.val(n))-9,"text-align":"center"});u.append(p);var g=$("<div><span></span></div>").css({position:"absolute",width:80,top:0,left:h(n),"text-align":"center"}).data("last-txt",m(e.val(n))).data("last-left",h(n));$("span",g).css({background:r.theme.colors.background,"font-weight":"bold",padding:"0 1ex"}).html(m(e.val(n)));u.append(g);$("<div />").css({position:"absolute",width:a+1,bottom:15,height:2,"border-bottom":"1px solid #000"}).appendTo(u);var v=$("<div />").css({position:"absolute",left:0,width:a,height:40});u.append(v);function x(t){var n=i.invert(t),r=Number.MAX_VALUE,a=0;e.each(function(e,t){var i=Math.abs(e.getTime()-n.getTime());if(i<r){r=i;a=t}});return a}var w;v.click(function(e){var t=e.clientX-v.offset().left,n=x(t);s(n);u.data("update-func")(n);clearTimeout(w)});v.mousemove(function(t){var n=t.clientX-v.offset().left,r=x(n);$("span",g).html(m(e.val(r)));g.css({left:h(r)});p.css({left:i(e.val(r))-10});clearTimeout(w);w=setTimeout(function(){s(r);g.data("last-left",h(r));g.data("last-txt",g.text())},500)});v.mouseleave(function(){g.css({left:g.data("last-left")});p.css({left:g.data("last-left")+30});$("span",g).html(g.data("last-txt"));clearTimeout(w)});u.data("update-func",function(t){p.stop().animate({left:i(e.val(t))-10},500,"expoInOut");var n=h(t),r=m(e.val(t));$("span",g).html(r);g.css({left:n});g.data("last-left",n);g.data("last-txt",r)});return u};return i}return o};t.chart=function(e){var n,r,a,i,u=[],o=[],s;var c={get:function(t,n){var r=t.split("."),a=e;_.each(r,function(e){if(a===undefined){return n}a=a[e]});return _.isUndefined(a)||_.isNull(a)?n:a},set:function(t,n){var r=t.split("."),a=r.pop(),i=e;_.each(r,function(e){if(_.isArray(i[e])&&i[e].length===0){i[e]={}}i=i[e]});if(!_.isEqual(i[a],n)){i[a]=n;_.each(o,function(e){if(_.isFunction(e))e(c,t,n)})}return this},load:function(){var e;e=t.datasource.delimited({url:"data",firstRowIsHeader:c.get("metadata.data.horizontal-header",true),transpose:c.get("metadata.data.transpose",false)});return e.dataset().done(function(e){n=e;_.each(u,function(e){if(_.isFunction(e))e(c)});u=[]})},loaded:function(e){if(n){e(c)}else{u.push(e)}},dataset:function(){return n},theme:function(e){if(arguments.length){r=e;return c}return r},vis:function(e){if(arguments.length){vis=e;vis.setChart(c);return c}return vis},hasHighlight:function(){var e=c.get("metadata.visualize.highlighted-series");return _.isArray(e)&&e.length>0},isHighlighted:function(e){if(_.isUndefined(e)===undefined)return false;var n=this.get("metadata.visualize.highlighted-series"),r=t.utils.name(e);return!_.isArray(n)||n.length===0||_.indexOf(n,r)>=0},locale:function(e){if(arguments.length){s=e;Globalize.culture(s);return c}return s},metricPrefix:function(e){if(arguments.length){i=e;return c}return i},formatValue:function(e,t,n){var r=c.get("metadata.describe.number-format"),a=Number(c.get("metadata.describe.number-divisor")),i=c.get("metadata.describe.number-append","").replace(" ","&nbsp;"),u=c.get("metadata.describe.number-prepend","").replace(" ","&nbsp;");if(a!==0)e=Number(e)/Math.pow(10,a);if(r!="-"){if(n||e==Math.round(e))r=r.substr(0,1)+"0";e=Globalize.format(e,r)}else if(a!==0){e=e.toFixed(1)}return t?u+e+i:e},render:function(e){if(!vis||!r||!n){throw"cannot render the chart!"}vis.setChart(c);vis.render(e)},attributes:function(t){if(arguments.length){e=t;return c}return e},onChange:function(e){o.push(e)}};return c};t.visualization=function(){var e={};var n={register:function(n){var r=arguments.length==3?e[arguments[1]].prototype:t.visualization.base,a=arguments[arguments.length-1],i=e[n]=function(){};_.extend(i.prototype,r,a)},create:function(t){return new e[t]}};return n}();t.visualization.base=function(){}.prototype;_.extend(t.visualization.base,{render:function(e){$(e).html("implement me!")},setTheme:function(e){if(!e)return this;this.theme=e;var t=["horizontalGrid","verticalGrid","yAxis","xAxis"];_.each(t,function(t){if(e.hasOwnProperty(t)){for(var n in e[t]){var r=n.replace(/([A-Z])/g,"-$1").toLowerCase();if(!e[t].hasOwnProperty(r)){e[t][r]=e[t][n]}}}});return this},setSize:function(e,t){var n=this;n.__w=e;n.__h=t;return n},get:function(e,t){return this.chart.get("metadata.visualize."+e,t)},warn:function(e){var t=$("<div>"+e+"</div>");t.css({"background-color":"#FCF8E3",border:"1px solid #FBEED5","border-radius":"4px 4px 4px 4px",color:"#a07833","margin-bottom":"18px",padding:"8px 35px 8px 14px","text-shadow":"0 1px 0 rgba(255, 255, 255, 0.5)",left:"10%",right:"10%","z-index":1e3,"text-align":"center",position:"absolute"});$("body").prepend(t);t.hide();t.fadeIn()},signature:function(){},translate:function(e){var t=this.meta.locale,n=this.lang;return t[e]?t[e][n]||t[e]:e},checkBrowserCompatibility:function(){return true},setChart:function(e){var t=this;t.dataset=e.dataset();t.setTheme(e.theme());t.chart=e;t.dataset.filterSeries(e.get("metadata.data.ignore-columns",{}))},axes:function(e){var t=this,n=t.dataset,r={},a={},i=[];_.each(t.meta.axes,function(e,t){function u(t){return!r[t.name()]&&_.indexOf(e.accepts,t.type())>=0}if(!e.optional){if(!e.multiple){var o=_.find(n.columns(),u);if(o){r[o.name()]=true;a[t]=o.name()}else{i.push("Error: Could not populate axis <b>"+t+"</b> a data column of the type "+e.accepts)}}else{a[t]=[];n.eachColumn(function(e){if(u(e)){r[e.name()]=true;a[t].push(e.name())}});if(!a[t].length){i.push("Error: Could not populate axis <b>"+t+"</b> with a column of the type "+e.accepts)}}}else{a[t]=false}});if(i.length){t.warn(i.join("<br/>"));return false}a=t.chart.get("metadata.axes",a);if(e){_.each(a,function(e,n){if(!_.isArray(e)){a[n]=e!==false?t.dataset.column(e):null}else{_.each(e,function(e,r){a[n][r]=e!==false?t.dataset.column(e):null})}})}return a},keys:function(){var e=this,n=e.axes();if(n.labels){var r=e.dataset.column(n.labels),a=t.utils.longDateFormat(r),i=[];r.each(function(e){i.push(a(e))});return i}return[]},reset:function(){this.clear();$("#chart").html("").off("click").off("mousemove").off("mouseenter").off("mouseover");$(".chart .filter-ui").remove();$(".chart .legend").remove()},clear:function(){}})}).call(this);